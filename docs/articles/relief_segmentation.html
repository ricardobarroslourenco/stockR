<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relief segmentation of the Hamilton area • stockR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Relief segmentation of the Hamilton area">
<meta property="og:description" content="stockR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stockR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/relief_segmentation.html">Relief segmentation of the Hamilton area</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ricardobarroslourenco/stockR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Relief segmentation of the Hamilton area</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ricardobarroslourenco/stockR/blob/HEAD/vignettes/relief_segmentation.Rmd" class="external-link"><code>vignettes/relief_segmentation.Rmd</code></a></small>
      <div class="hidden name"><code>relief_segmentation.Rmd</code></div>

    </div>

    
    
<p>Library loads:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ricardobarroslourenco/stockR" class="external-link">stockR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">graphics</span><span class="op">)</span></code></pre></div>
<hr>
<p>First we load the raw digital elevation model</p>
<p>(a major refactor was incorporating the usage of the Raster package {<a href="https://www.neonscience.org/resources/learning-hub/tutorials/raster-data-r" class="external-link">link1</a>}{<a href="https://rdrr.io/cran/raster/man/raster-package.html" class="external-link">link2</a>}, which brings a lot of functionalities of traditional remote sensing data workflows in a standardized way)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dem_hamont</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem_hamont</span>, main<span class="op">=</span><span class="st">'Digital Elevation Model'</span><span class="op">)</span></code></pre></div>
<p><img src="relief_segmentation_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<hr>
<p>Now we calculate the distribution of heights in this region:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">dem_hamont</span>, main<span class="op">=</span><span class="st">"Distribution of elevation values"</span>, 
     col<span class="op">=</span> <span class="st">"purple"</span>, 
     maxpixels<span class="op">=</span><span class="fl">22000000</span><span class="op">)</span></code></pre></div>
<p><img src="relief_segmentation_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>On the histogram, we see at least four classes (approximately):</p>
<ul>
<li>A high peak around 70m;</li>
<li>A section between 70m and 200m;</li>
<li>A third section betwwen 200-225m;</li>
<li>A final section of values above 225m (up to around 325m).</li>
</ul>
<hr>
<p>Based on this histogram pattern, it is possible to derive labels for each pixel as a manner to do a initial Land Cover, using an unsupervised method.</p>
<p>For this end, we can use a classical clustering algorithm, <a href="https://en.wikipedia.org/wiki/K-means_clustering" class="external-link">K-means</a>.</p>
<p>The <strong>naïve k-means</strong>* can be defined as:</p>
<pre class="text"><code>
Step 1: Set k initial means , to be randomly assigned in the domain being clustered;

Step 2: Associate every observation with the nearest mean (this generates a Voronoi partition field);

Step 3: The centroid of each cluster (each Voronoi partition) becomes the new mean;

Step 4: Repeat steps 2 and 3 until reaching convergence.</code></pre>
<p><strong>Note:</strong> Convergence on the naïve k-means is a NP-hard problem. Packages often solve this by using heuristics and other strategies for early stopping.</p>
<p>The complexity of the naïve k-means is <span class="math inline">\(O(nkdi)\)</span> where:</p>
<ul>
<li>
<span class="math inline">\(n\)</span> being the number of n-dimensional;</li>
<li>
<span class="math inline">\(k\)</span> the number of clusters;</li>
<li>
<span class="math inline">\(i\)</span> the number of iterations needed until convergence (early stop criteria). vectors (considering a single sample an n-dimensional vector)</li>
</ul>
<hr>
<p>For our application, we may define :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">getValues</a></span><span class="op">(</span><span class="va">dem_hamont</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># We want to create 10 clusters, allow 500 iterations, start with 5 random sets using "Lloyd" method</span>
<span class="va">kmncluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">nr</span><span class="op">)</span>, centers <span class="op">=</span> <span class="fl">4</span>, iter.max <span class="op">=</span> <span class="fl">500</span>, nstart <span class="op">=</span> <span class="fl">4</span>, algorithm<span class="op">=</span><span class="st">"Lloyd"</span><span class="op">)</span>

<span class="co"># kmeans returns an object of class "kmeans"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">kmncluster</span><span class="op">)</span>
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ cluster     : int [1:3960031] 2 2 2 2 2 2 2 2 2 2 ...</span>
<span class="co">#&gt;  $ centers     : num [1:4, 1] 81 285 242 202</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:4] "1" "2" "3" "4"</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;  $ totss       : num 2.09e+10</span>
<span class="co">#&gt;  $ withinss    : num [1:4] 2.77e+08 1.38e+08 1.30e+08 2.86e+08</span>
<span class="co">#&gt;  $ tot.withinss: num 8.31e+08</span>
<span class="co">#&gt;  $ betweenss   : num 2.01e+10</span>
<span class="co">#&gt;  $ size        : int [1:4] 1064750 534240 901297 1459744</span>
<span class="co">#&gt;  $ iter        : int 18</span>
<span class="co">#&gt;  $ ifault      : NULL</span>
<span class="co">#&gt;  - attr(*, "class")= chr "kmeans"</span></code></pre></div>
<p>The fixed seed is set, to be able to reproduce performance (although not recommended for production usage). In which <span class="math inline">\(k = 4\)</span> and <span class="math inline">\(i=500\)</span>, as defined at the naïve k-means algorithm.</p>
<p>Other relevant information comes from the run output (take in consideration that here it is analyzed the ones resultant from <span class="math inline">\(seed = 1\)</span>):</p>
<ul>
<li>Withiness (named as <span class="math inline">\(withinss\)</span>) : values of magnitude at order 8</li>
<li>Betweeness (named as <span class="math inline">\(betweenss\)</span>) : values of magnitude at order 10</li>
<li>Iterations (named as <span class="math inline">\(iter\)</span>) : 18 (out of the initial 500 allowed as maximum)</li>
</ul>
<p>From this output is important to highlight that convergence is reached fast, with only 18 iterations. Another aspect is that despite the data variance, the algorithm produces classes that are homogeneous, in comparison of others (by maximizing intraclass similarity, with values for each class at order eight, while maximizing extraclass dissimilarity, with values of classes distant at order ten - with basically two orders of magnitude of separation).</p>
<hr>
<p>With this successful result, we can assign classes to these images as:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">dem_hamont</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">values</a></span><span class="op">(</span><span class="va">knr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">kmncluster</span><span class="op">$</span><span class="va">cluster</span>
<span class="va">knr</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1241, 3191, 3960031  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0002694946, 0.0002694946  (x, y)</span>
<span class="co">#&gt; extent     : -80.35811, -79.49816, 43.07578, 43.41023  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 1, 4  (min, max)</span></code></pre></div>
<p>And finally, we compare the original data with color ramp to the learned classes:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e41a1c"</span>,<span class="st">"#377eb8"</span>, <span class="st">"#4daf4a"</span>, <span class="st">"#984ea3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem_hamont</span>, main <span class="op">=</span> <span class="st">'DEM Nasa'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">knr</span>, main <span class="op">=</span> <span class="st">'K-means (k=4)'</span>, col <span class="op">=</span> <span class="va">mycolor</span> <span class="op">)</span></code></pre></div>
<p><img src="relief_segmentation_files/figure-html/unnamed-chunk-7-1.png" width="700"> As we can see, the choice of four classes allow to segment relevant regions in the area such as the Lake Ontario (in red), the Mountain area of Hamilton (in violet), the higher area in Burlington (in blue), and lower areas of both Hamilton and Burlington.</p>
<p>Note that the smaller portion of lake ontario that is closer to the Royal Botaninc Gardens and Cootes Paradise, is not put together with the main Lake Ontario class. This is maybe due to errors in acquisition, in which this section closer to the lake edge, gets some influence from its higher neighborhood. In this case the k-means algorithm only looks to single pixel values, and is prone to errors such as these (which may be solved with usage of better spatial representations).</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ricardo Barros Lourenco.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
